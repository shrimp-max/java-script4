<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Muscle Training</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <h1>筋トレ管理アプリ</h1>
    <div id="workout-form">
        <h2>筋トレメニューを追加</h2>
        <input type="text" id="exercise-name" placeholder="トレーニング名">
        <input type="number" id="weight" placeholder="重量 (kg)">
        <input type="number" id="reps" placeholder="回数">
        <button id="add-workout">追加</button>
    </div>

    <div id="workout-history">
        <h2>筋トレ履歴</h2>
        <ul id="workout-list"></ul>
    </div>

<!-- JQuery -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<!-- JQuery -->

<!--** 以下Firebase **-->
<script type="module">

    // Import the functions you need from the SDKs you need
    import { initializeApp } 
        from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
    import { getDatabase, ref, push, set, update, remove, onChildAdded, onChildChanged, onChildRemoved} 
        from "https://www.gstatic.com/firebasejs/10.12.5/firebase-database.js"; //2行上のバージョンナンバーと揃えないと動かない
    import { getAuth, signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged } 
        from "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js"; 
    import { getAnalytics } 
        from "https://www.gstatic.com/firebasejs/10.12.5/firebase-analytics.js";

    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries

    // Firebase設定
    const firebaseConfig = {
        apiKey: "AIzaSyA0xk3nHvgPfuDQyE_YXowfylsCQb3KYf8",
        authDomain: "gsdemo-2.firebaseapp.com",
        databaseURL: "https://gsdemo-2-default-rtdb.firebaseio.com",
        projectId: "gsdemo-2",
        storageBucket: "gsdemo-2.appspot.com",
        messagingSenderId: "458526585283",
        appId: "1:458526585283:web:ecef01720016ec66698d76",
        measurementId: "G-J6FS8G51MP"
    };

    const app = initializeApp(firebaseConfig); //firebaseにアクセスして誰かを確認する
    const db  = getDatabase(app); //RealtimeDBに接続
    const dbRef = ref(db, "muscletraining"); 
    
    // 現在の日付を取得
        const getCurrentDate = () => {
        const today = new Date();
        const year = today.getFullYear();
        const month = ("0" + (today.getMonth() + 1)).slice(-2);
        const day = ("0" + today.getDate()).slice(-2);
        return `${year}-${month}-${day}`;
    };
    
    // 筋トレメニューを追加
    $('#add-workout').on('click', function() {
        const exerciseName = $('#exercise-name').val();
        const weight = $('#weight').val();
        const reps = $('#reps').val();
        const date = getCurrentDate();
        const workoutData = {
        exerciseName: exerciseName,
        weight: weight,
        reps: reps
        };
    
        const userId = "userId1"; // ユーザーIDは適宜設定
        const newWorkoutKey = dbRef.ref().child(`users/${userId}/workouts/${date}`).push().key;
    
        dbRef.ref(`users/${userId}/workouts/${date}/${newWorkoutKey}`).set(workoutData)
        .then(() => {
            $('#exercise-name').val('');
            $('#weight').val('');
            $('#reps').val('');
            loadWorkouts();
        });
    });
    
    // 筋トレ履歴を表示
    const loadWorkouts = () => {
        const date = getCurrentDate();
        const userId = "userId1"; // ユーザーIDは適宜設定
    
        dbRef.ref(`users/${userId}/workouts/${date}`).once('value', snapshot => {
        $('#workout-list').empty();
        snapshot.forEach(childSnapshot => {
            const workout = childSnapshot.val();
            $('#workout-list').append(`<li>${workout.exerciseName} - ${workout.weight}kg x ${workout.reps}回</li>`);
        });
        });
    };
    
    // ページロード時に履歴を読み込む
    $(document).ready(function() {
        loadWorkouts();
    });

    
</script>
</body>
</html>


